<?php

use App\Controllers\AuthentificationController;
use App\Controllers\Commission\DiscussionController;
use App\Controllers\CommissionController;
use App\Controllers\Gestions\AttributionMenuController;
use App\Controllers\Gestions\EcueController;
use App\Controllers\Gestions\EnseignantsController;
use App\Controllers\Gestions\EtudiantsController;
use App\Controllers\Gestions\EvaluationEtudiantController;
use App\Controllers\Gestions\PersonnelAdministratifController;
use App\Controllers\Gestions\ReglementInscriptionController;
use App\Controllers\Gestions\UeController;
use App\Controllers\Gestions\UtilisateursController;
use App\Controllers\IndexController;
use App\Controllers\Public\AccueilController;
use App\Controllers\Public\AuthentificationPublicController;
use App\Controllers\Public\SoumissionRapportController;

/**
 * Configuration des modules disponibles dans l'application.
 * Chaque module peut d√©finir une m√©thode principale (pour l'affichage)
 * et une liste de traitements sp√©cifiques (pour les actions POST, etc.).
 */
$configurationModules = [
    'gestion' => [
        'personnel-administratif' => [
            'controleur' => PersonnelAdministratifController::class,
            'methodePrincipale' => 'index',
            'label' => 'Personnel Administratif',
            'icone' => 'üë®‚Äçüíº',
            'description' => 'Gestion du personnel administratif de l\'√©tablissement',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel √©l√©ment de personnel administratif'
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier un √©l√©ment de personnel administratif existant'
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un √©l√©ment de personnel administratif',
                    // 'action' => 'supprimerPersonnel'
                ]
            ]
        ],
        'enseignants' => [
            'controleur' => EnseignantsController::class,
            'methodePrincipale' => 'index',
            'label' => 'Enseignants',
            'icone' => 'üë®‚Äçüè´', // Correction: L'ic√¥ne √©tait incompl√®te 'üë®‚Äç'
            'description' => 'Gestion du corps enseignant',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel enseignant',
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier les informations d\'un enseignant existant',
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un enseignant',
                ]
            ]
        ],
        'etudiants' => [
            'controleur' => EtudiantsController::class,
            'methodePrincipale' => 'index',
            'label' => '√âtudiants',
            'icone' => 'üë®‚Äç',
            'description' => 'Gestion des √©tudiants de l\'√©tablissement',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel √©tudiant',
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier les informations d\'un √©tudiant existant',
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un √©tudiant',
                ]
            ]
        ],
        'utilisateurs' => [
            'controleur' => UtilisateursController::class,
            'methodePrincipale' => 'index',
            'label' => 'Utilsateur',
            'icone' => 'üë®‚Äç',
            'description' => 'Gestion des utilisateurs de l\'√©tablissement',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel √©tudiant',
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier les informations d\'un √©tudiant existant',
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un √©tudiant',
                ]
            ]
        ],
        'evaluation-etudiant' => [
            'controleur' => EvaluationEtudiantController::class,
            'methodePrincipale' => 'index',
            'label' => '√âvaluation √âtudiants',
            'icone' => 'ü§ß‚Äç',
            'description' => 'Gestion des √©tudiants de l\'√©tablissement',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel √©tudiant',
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier les informations d\'un √©tudiant existant',
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un √©tudiant',
                ]
            ]
        ],
        'attribution-menu' => [
            'controleur' => AttributionMenuController::class,
            'methodePrincipale' => 'index',
            'label' => 'Gestion des menus',
            'icone' => 'üíÅüèæ‚Äç‚ôÇÔ∏è',
            'description' => 'Gestion des √©tudiants de l\'√©tablissement',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel √©tudiant',
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier les informations d\'un √©tudiant existant',
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un √©tudiant',
                ]
            ]
        ],
        'ue' => [
            'controleur' => UeController::class,
            'methodePrincipale' => 'index',
            'label' => 'UE',
            'icone' => 'üíÅüèæ‚Äç',
            'description' => 'Gestion des √©tudiants de l\'√©tablissement',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel √©tudiant',
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier les informations d\'un √©tudiant existant',
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un √©tudiant',
                ]
            ]
        ],
        'ecue' => [
            'controleur' => EcueController::class,
            'methodePrincipale' => 'index',
            'label' => 'ECUE',
            'icone' => 'üíÅüèæ‚Äç',
            'description' => 'Gestion des √©tudiants de l\'√©tablissement',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel √©tudiant',
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier les informations d\'un √©tudiant existant',
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un √©tudiant',
                ]
            ]
        ],
        'reglement-inscription' => [
            'controleur' => ReglementInscriptionController::class,
            'methodePrincipale' => 'index',
            'label' => 'Reglement Inscription',
            'icone' => 'üí≤',
            'description' => 'Gestion des √©tudiants de l\'√©tablissement',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel √©tudiant',
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier les informations d\'un √©tudiant existant',
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un √©tudiant',
                ]
            ]
        ],
        'messagerie-commission' => [
            'controleur' => DiscussionController::class,
            'methodePrincipale' => 'index',
            'label' => 'Discussion',
            'icone' => 'üòé',
            'description' => 'Gestion des √©tudiants de l\'√©tablissement',
            'traitements' => [
                'ajouter' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Ajouter un nouvel √©tudiant',
                ],
                'modifier' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Modifier les informations d\'un √©tudiant existant',
                ],
                'supprimer' => [
                    'methodeHttp' => 'POST',
                    'description' => 'Supprimer un √©tudiant',
                ]
            ]
        ],

    ]
];

// Stockage global de la configuration pour y acc√©der dans les contr√¥leurs.
// Cela garantit que la configuration est disponible partout sans la passer explicitement.
if (!defined('MODULES_CONFIG')) {
    define('MODULES_CONFIG', $configurationModules);
}

/**
 * D√©finition des routes de l'application.
 * Chaque route est un tableau: [m√©thode HTTP, chemin, [Contr√¥leur::class, 'm√©thode']].
 */
$routes = [
    /* === Routes des pages publiques === */
    ['GET', '/', [AccueilController::class, 'index']],
    ['GET', '/authentification', [AuthentificationPublicController::class, 'index']],
    ['GET', '/authentification-administration', [AuthentificationController::class, 'index']],
    ['GET', '/soumission-rapport', [SoumissionRapportController::class, 'index']],
    ['GET', '/test-animations', [AccueilController::class, 'testAnimations']],
    ['GET', '/espace-commission', [CommissionController::class, 'index']],
    ['GET', '/espace-commission/commission/discussion', [DiscussionController::class, 'index']],

    /* === Routes de l'espace administrateur === */
    ['GET', '/index', [IndexController::class, 'index']],
];

/**
 * G√©n√©ration automatique des routes pour les modules et leurs traitements.
 * Cela permet de ne pas avoir √† √©crire chaque route manuellement.
 */
foreach ($configurationModules as $categorie => $modulesParCategorie) {
    foreach ($modulesParCategorie as $nomModule => $configurationModule) {
        /* === Routes des menus de l'administrateur (GET) === */
        $routes[] = ['GET', "/index/$categorie/$nomModule", [IndexController::class, 'gestionMenuModules']];

        // Ajout des routes pour les traitements sp√©cifiques du module (POST, etc.)
        if (isset($configurationModule['traitements'])) {
            foreach ($configurationModule['traitements'] as $nomTraitement => $configTraitement) {
                $routes[] = [
                    $configTraitement['methodeHttp'],
                    "/index/$categorie/$nomModule/$nomTraitement/",
                    [IndexController::class, 'gererTraitementModule']
                ];

                // Route directe pour API
                if (class_exists($configurationModule['controleur'])) {
                    $routes[] = [
                        $configTraitement['methodeHttp'],
                        "/$categorie/$nomModule/$nomTraitement",
                        [$configurationModule['controleur'], $nomTraitement]
                    ];
                }
            }
        }
    }
}

// Ajouter les routes de traitement des formulaires (authentification, par exemple)
$routes = array_merge($routes, [
    /* === Routes des traitements (formulaires) === */
    ['POST', '/authentification', [AuthentificationPublicController::class, 'authentification']],
    ['POST', '/authentification-administration', [AuthentificationController::class, 'authentification']],
]);


return $routes;